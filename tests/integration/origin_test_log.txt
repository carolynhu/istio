2020-11-24T19:09:35.619187Z	info	tf	=== Test Framework Settings ===
2020-11-24T19:09:35.619303Z	info	tf	TestID:            security_sds_tls_origination
RunID:             b1db9ff7-1447-4994-a331-a72e61c528ef
NoCleanup:         true
BaseDir:           /tmp
Selector:          
FailOnDeprecation: false

2020-11-24T19:09:35.619311Z	info	tf	===============================
2020-11-24T19:09:35.619398Z	info	tf	Test run dir: /tmp/security-sds-tls-origination-b1
2020-11-24T19:09:35.619459Z	info	tf	Test Framework Kubernetes environment Settings:
KubeConfig:           [/root/bmctl-workspace/asm7-build71/asm7-build71-kubeconfig]
MiniKubeIngress:      false
ControlPlaneTopology: map[0:0]
NetworkTopology:      map[]

2020-11-24T19:09:35.621720Z	info	tf	=== BEGIN: Setup: 'security_sds_tls_origination' ===
2020-11-24T19:09:35.631874Z	info	tf	=== BEGIN: Deploy Istio [Suite=security_sds_tls_origination] ===
2020-11-24T19:09:35.631902Z	info	tf	=== Istio Component Config ===
2020-11-24T19:09:35.631932Z	info	tf	
SystemNamespace:                istio-system
IstioNamespace:                 istio-system
ConfigNamespace:                istio-system
TelemetryNamespace:             istio-system
PolicyNamespace:                istio-system
IngressNamespace:               istio-system
EgressNamespace:                istio-system
DeployIstio:                    true
DeployTimeout:                  5m0s
UndeployTimeout:                5m0s
Values:                         map[global.hub:gcr.io/mixologist-142215/baremetal_asm global.imagePullPolicy:Always global.tag:1.7.3]
IOPFile:                        tests/integration/iop-integration-test-defaults.yaml
SkipWaitForValidationWebhook:   false
CustomSidecarInjectorNamespace: 

2020-11-24T19:09:35.631937Z	info	tf	================================
2020-11-24T19:09:35.632588Z	info	proto: tag has too few fields: "-"
2020-11-24T19:09:36.067742Z	info	tf	Running istio control plane on cluster cluster-0 [install --skip-confirmation -f /root/go_projects/src/istio.io/istio/tests/integration/iop-integration-test-defaults.yaml -f /tmp/security-sds-tls-origination-b1/_suite_context/istio-deployment-671938989/iop.yaml --set values.global.imagePullPolicy=Always --manifests /root/go_projects/src/istio.io/istio/manifests --set values.global.hub=gcr.io/mixologist-142215/baremetal_asm --set values.global.tag=1.7.3 --set values.global.imagePullPolicy=Always]

- Processing resources for Istio core.
✔ Istio core installed
- Processing resources for Istiod.
- Processing resources for Istiod. Waiting for Deployment/istio-system/istiod
✔ Istiod installed
- Processing resources for Egress gateways.
- Processing resources for Egress gateways. Waiting for Deployment/istio-syst...
✔ Egress gateways installed
- Pruning removed resources
✔ Installation complete2020-11-24T19:10:24.466545Z	info	tf	Creating dummy rule to check for validation webhook readiness
2020-11-24T19:10:24.791440Z	info	tf	Creating dummy rule to check for validation webhook readiness
2020-11-24T19:10:24.847406Z	info	tf	=== SUCCEEDED: Deploy Istio [Suite=security_sds_tls_origination]===
2020-11-24T19:10:24.847450Z	info	tf	=== DONE: Setup: 'security_sds_tls_origination' (49.225698254s) ===
2020-11-24T19:10:24.847459Z	info	tf	=== BEGIN: Test Run: 'security_sds_tls_origination' ===
2020-11-24T19:10:24.847962Z	info	tf	=== BEGIN: Test: 'security_sds_tls_origination[TestSimpleTlsOrigination]' ===
2020-11-24T19:10:25.106040Z	info	tf	Checking pods ready...
2020-11-24T19:10:25.106090Z	info	tf	Checking pods ready...
2020-11-24T19:10:25.106059Z	info	tf	Checking pods ready...
2020-11-24T19:10:25.106207Z	info	tf	Checking pods ready...
2020-11-24T19:10:25.115969Z	info	tf	Failed retrieving pods: no pods found for [app=server]
2020-11-24T19:10:25.253027Z	info	tf	  [ 0]                    client-v1-5589bc9b54-x98xk         Pending (Pending)
2020-11-24T19:10:26.116124Z	info	tf	Checking pods ready...
2020-11-24T19:10:26.116174Z	info	tf	Checking pods ready...
2020-11-24T19:10:26.120905Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-xbwjl         Pending (Pending)
2020-11-24T19:10:26.253169Z	info	tf	Checking pods ready...
2020-11-24T19:10:26.253215Z	info	tf	Checking pods ready...
2020-11-24T19:10:26.258606Z	info	tf	  [ 0]                    client-v1-5589bc9b54-x98xk         Pending (Pending)
2020-11-24T19:10:27.121045Z	info	tf	Checking pods ready...
2020-11-24T19:10:27.121088Z	info	tf	Checking pods ready...
2020-11-24T19:10:27.125158Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-xbwjl         Pending (Pending)
2020-11-24T19:10:27.258750Z	info	tf	Checking pods ready...
2020-11-24T19:10:27.258787Z	info	tf	Checking pods ready...
2020-11-24T19:10:27.264337Z	info	tf	  [ 0]                    client-v1-5589bc9b54-x98xk         Pending (Pending)
2020-11-24T19:10:28.125398Z	info	tf	Checking pods ready...
2020-11-24T19:10:28.125441Z	info	tf	Checking pods ready...
2020-11-24T19:10:28.130111Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-xbwjl         Running (container not ready: 'app')
2020-11-24T19:10:28.264620Z	info	tf	Checking pods ready...
2020-11-24T19:10:28.264676Z	info	tf	Checking pods ready...
2020-11-24T19:10:28.270593Z	info	tf	  [ 0]                    client-v1-5589bc9b54-x98xk         Pending (Pending)
2020-11-24T19:10:29.130390Z	info	tf	Checking pods ready...
2020-11-24T19:10:29.130451Z	info	tf	Checking pods ready...
2020-11-24T19:10:29.134824Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-xbwjl         Running (container not ready: 'app')
2020-11-24T19:10:29.270685Z	info	tf	Checking pods ready...
2020-11-24T19:10:29.270732Z	info	tf	Checking pods ready...
2020-11-24T19:10:29.276222Z	info	tf	  [ 0]                    client-v1-5589bc9b54-x98xk         Running (container not ready: 'app')
2020-11-24T19:10:30.135107Z	info	tf	Checking pods ready...
2020-11-24T19:10:30.135160Z	info	tf	Checking pods ready...
2020-11-24T19:10:30.139782Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-xbwjl         Running (container not ready: 'app')
2020-11-24T19:10:30.276487Z	info	tf	Checking pods ready...
2020-11-24T19:10:30.276554Z	info	tf	Checking pods ready...
2020-11-24T19:10:30.281577Z	info	tf	  [ 0]                    client-v1-5589bc9b54-x98xk         Running (container not ready: 'app')
2020-11-24T19:10:31.140038Z	info	tf	Checking pods ready...
2020-11-24T19:10:31.140080Z	info	tf	Checking pods ready...
2020-11-24T19:10:31.144387Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-xbwjl         Running (container not ready: 'app')
2020-11-24T19:10:31.281877Z	info	tf	Checking pods ready...
2020-11-24T19:10:31.281930Z	info	tf	Checking pods ready...
2020-11-24T19:10:31.287096Z	info	tf	  [ 0]                    client-v1-5589bc9b54-x98xk         Running (container not ready: 'app')
2020-11-24T19:10:32.144644Z	info	tf	Checking pods ready...
2020-11-24T19:10:32.144686Z	info	tf	Checking pods ready...
2020-11-24T19:10:32.149228Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-xbwjl         Running (container not ready: 'app')
2020-11-24T19:10:32.287329Z	info	tf	Checking pods ready...
2020-11-24T19:10:32.287369Z	info	tf	Checking pods ready...
2020-11-24T19:10:32.292214Z	info	tf	  [ 0]                    client-v1-5589bc9b54-x98xk         Running (container not ready: 'app')
2020-11-24T19:10:33.149511Z	info	tf	Checking pods ready...
2020-11-24T19:10:33.149576Z	info	tf	Checking pods ready...
2020-11-24T19:10:33.154647Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-xbwjl         Running (container not ready: 'app')
2020-11-24T19:10:33.292445Z	info	tf	Checking pods ready...
2020-11-24T19:10:33.292499Z	info	tf	Checking pods ready...
2020-11-24T19:10:33.297694Z	info	tf	  [ 0]                    client-v1-5589bc9b54-x98xk         Running (container not ready: 'app')
2020-11-24T19:10:34.154911Z	info	tf	Checking pods ready...
2020-11-24T19:10:34.154950Z	info	tf	Checking pods ready...
2020-11-24T19:10:34.159848Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-xbwjl         Running (container not ready: 'app')
2020-11-24T19:10:34.297931Z	info	tf	Checking pods ready...
2020-11-24T19:10:34.297985Z	info	tf	Checking pods ready...
2020-11-24T19:10:34.302865Z	info	tf	  [ 0]                    client-v1-5589bc9b54-x98xk         Running (container not ready: 'app')
2020-11-24T19:10:35.160143Z	info	tf	Checking pods ready...
2020-11-24T19:10:35.160182Z	info	tf	Checking pods ready...
2020-11-24T19:10:35.164607Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-xbwjl         Running (container not ready: 'app')
2020-11-24T19:10:35.303134Z	info	tf	Checking pods ready...
2020-11-24T19:10:35.303191Z	info	tf	Checking pods ready...
2020-11-24T19:10:35.308506Z	info	tf	  [ 0]                    client-v1-5589bc9b54-x98xk         Running (container not ready: 'app')
2020-11-24T19:10:36.164870Z	info	tf	Checking pods ready...
2020-11-24T19:10:36.164911Z	info	tf	Checking pods ready...
2020-11-24T19:10:36.169997Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-xbwjl         Running (Ready)
2020-11-24T19:10:36.308755Z	info	tf	Checking pods ready...
2020-11-24T19:10:36.308824Z	info	tf	Checking pods ready...
2020-11-24T19:10:36.313752Z	info	tf	  [ 0]                    client-v1-5589bc9b54-x98xk         Running (container not ready: 'app')
2020-11-24T19:10:37.313913Z	info	tf	Checking pods ready...
2020-11-24T19:10:37.313969Z	info	tf	Checking pods ready...
2020-11-24T19:10:37.319165Z	info	tf	  [ 0]                    client-v1-5589bc9b54-x98xk         Running (container not ready: 'app')
2020-11-24T19:10:38.319401Z	info	tf	Checking pods ready...
2020-11-24T19:10:38.319443Z	info	tf	Checking pods ready...
2020-11-24T19:10:38.323851Z	info	tf	  [ 0]                    client-v1-5589bc9b54-x98xk         Running (Ready)
2020-11-24T19:10:46.824487Z	info	tf	=== DONE (passed):  Test: 'security_sds_tls_origination[TestSimpleTlsOrigination] (21.976513985s)' ===
2020-11-24T19:10:46.825318Z	info	tf	=== BEGIN: Test: 'security_sds_tls_origination[TestMutualTlsOrigination]' ===
2020-11-24T19:10:49.407993Z	info	tf	Checking pods ready...
2020-11-24T19:10:49.408019Z	info	tf	Checking pods ready...
2020-11-24T19:10:49.408033Z	info	tf	Checking pods ready...
2020-11-24T19:10:49.408043Z	info	tf	Checking pods ready...
2020-11-24T19:10:49.606037Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-fbqzt         Pending (Pending)
2020-11-24T19:10:49.807954Z	info	tf	  [ 0]                    client-v1-5589bc9b54-2x4lz         Pending (Pending)
2020-11-24T19:10:50.606311Z	info	tf	Checking pods ready...
2020-11-24T19:10:50.606369Z	info	tf	Checking pods ready...
2020-11-24T19:10:50.612238Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-fbqzt         Pending (Pending)
2020-11-24T19:10:50.808183Z	info	tf	Checking pods ready...
2020-11-24T19:10:50.808237Z	info	tf	Checking pods ready...
2020-11-24T19:10:50.813659Z	info	tf	  [ 0]                    client-v1-5589bc9b54-2x4lz         Pending (Pending)
2020-11-24T19:10:51.612476Z	info	tf	Checking pods ready...
2020-11-24T19:10:51.612537Z	info	tf	Checking pods ready...
2020-11-24T19:10:51.617510Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-fbqzt         Pending (Pending)
2020-11-24T19:10:51.813899Z	info	tf	Checking pods ready...
2020-11-24T19:10:51.813955Z	info	tf	Checking pods ready...
2020-11-24T19:10:51.819459Z	info	tf	  [ 0]                    client-v1-5589bc9b54-2x4lz         Pending (Pending)
2020-11-24T19:10:52.617729Z	info	tf	Checking pods ready...
2020-11-24T19:10:52.617772Z	info	tf	Checking pods ready...
2020-11-24T19:10:52.622858Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-fbqzt         Running (container not ready: 'app')
2020-11-24T19:10:52.819699Z	info	tf	Checking pods ready...
2020-11-24T19:10:52.819740Z	info	tf	Checking pods ready...
2020-11-24T19:10:52.830374Z	info	tf	  [ 0]                    client-v1-5589bc9b54-2x4lz         Pending (Pending)
2020-11-24T19:10:53.623100Z	info	tf	Checking pods ready...
2020-11-24T19:10:53.623151Z	info	tf	Checking pods ready...
2020-11-24T19:10:53.628079Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-fbqzt         Running (container not ready: 'app')
2020-11-24T19:10:53.830625Z	info	tf	Checking pods ready...
2020-11-24T19:10:53.830681Z	info	tf	Checking pods ready...
2020-11-24T19:10:53.836066Z	info	tf	  [ 0]                    client-v1-5589bc9b54-2x4lz         Running (container not ready: 'app')
2020-11-24T19:10:54.628278Z	info	tf	Checking pods ready...
2020-11-24T19:10:54.628316Z	info	tf	Checking pods ready...
2020-11-24T19:10:54.633890Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-fbqzt         Running (Ready)
2020-11-24T19:10:54.836279Z	info	tf	Checking pods ready...
2020-11-24T19:10:54.836323Z	info	tf	Checking pods ready...
2020-11-24T19:10:54.841780Z	info	tf	  [ 0]                    client-v1-5589bc9b54-2x4lz         Running (container not ready: 'app')
2020-11-24T19:10:55.842038Z	info	tf	Checking pods ready...
2020-11-24T19:10:55.842094Z	info	tf	Checking pods ready...
2020-11-24T19:10:55.848137Z	info	tf	  [ 0]                    client-v1-5589bc9b54-2x4lz         Running (container not ready: 'app')
2020-11-24T19:10:56.848325Z	info	tf	Checking pods ready...
2020-11-24T19:10:56.848366Z	info	tf	Checking pods ready...
2020-11-24T19:10:56.855423Z	info	tf	  [ 0]                    client-v1-5589bc9b54-2x4lz         Running (container not ready: 'app')
2020-11-24T19:10:57.855569Z	info	tf	Checking pods ready...
2020-11-24T19:10:57.855619Z	info	tf	Checking pods ready...
2020-11-24T19:10:57.860988Z	info	tf	  [ 0]                    client-v1-5589bc9b54-2x4lz         Running (container not ready: 'app')
2020-11-24T19:10:58.861215Z	info	tf	Checking pods ready...
2020-11-24T19:10:58.861267Z	info	tf	Checking pods ready...
2020-11-24T19:10:58.873989Z	info	tf	  [ 0]                    client-v1-5589bc9b54-2x4lz         Running (Ready)
2020-11-24T19:11:05.491296Z	info	tf	=== BEGIN: Test: 'security_sds_tls_origination[TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_and_client_certs_and_generic_secret_type]' ===
2020-11-24T19:11:05.530142Z	info	tf	=== DONE (failed):  Test: 'security_sds_tls_origination[TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_and_client_certs_and_generic_secret_type] (38.841334ms)' ===
2020-11-24T19:11:05.530316Z	info	tf	=== BEGIN: Test: 'security_sds_tls_origination[TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_and_client_certs_and_non_generic_secret_type]' ===
2020-11-24T19:11:05.571853Z	info	tf	=== DONE (failed):  Test: 'security_sds_tls_origination[TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_and_client_certs_and_non_generic_secret_type] (41.52622ms)' ===
2020-11-24T19:11:05.572128Z	info	tf	=== BEGIN: Test: 'security_sds_tls_origination[TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_but_invalid_client_cert]' ===
2020-11-24T19:11:05.610498Z	info	tf	=== DONE (failed):  Test: 'security_sds_tls_origination[TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_but_invalid_client_cert] (38.365504ms)' ===
2020-11-24T19:11:05.610703Z	info	tf	=== BEGIN: Test: 'security_sds_tls_origination[TestMutualTlsOrigination/MUTUAL_TLS_with_credentialName_set_when_the_underlying_secret_doesn't_exist]' ===
2020-11-24T19:11:05.645396Z	info	tf	=== DONE (failed):  Test: 'security_sds_tls_origination[TestMutualTlsOrigination/MUTUAL_TLS_with_credentialName_set_when_the_underlying_secret_doesn't_exist] (34.68381ms)' ===
2020-11-24T19:11:05.645646Z	info	tf	=== BEGIN: Test: 'security_sds_tls_origination[TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_but_no_client_certs]' ===
2020-11-24T19:11:05.682737Z	info	tf	=== DONE (failed):  Test: 'security_sds_tls_origination[TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_but_no_client_certs] (37.08621ms)' ===
2020-11-24T19:11:06.501020Z	info	tf	=== DONE (failed):  Test: 'security_sds_tls_origination[TestMutualTlsOrigination] (19.675688816s)' ===
2020-11-24T19:11:06.501071Z	error	tf	=== Dumping Namespace client-3-51384 State...
2020-11-24T19:11:08.088119Z	error	tf	=== Dumping Namespace server-4-30056 State...
--- FAIL: TestMutualTlsOrigination (21.29s)
    --- FAIL: TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_and_client_certs_and_generic_secret_type (0.04s)
        config.go:68: failed applying YAML to cluster cluster-0: error when creating "/tmp/security-sds-tls-origination-b1/TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_and_client_certs_and_generic_secret_type/tmpyaml_783873086": admission webhook "validation.istio.io" denied the request: configuration is invalid: 2 errors occurred:
            	* client certificate required for mutual tls
            	* private key required for mutual tls
            
            : 
    --- FAIL: TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_and_client_certs_and_non_generic_secret_type (0.04s)
        config.go:68: failed applying YAML to cluster cluster-0: error when creating "/tmp/security-sds-tls-origination-b1/TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_and_client_certs_and_non_generic_secret_type/tmpyaml_866126469": admission webhook "validation.istio.io" denied the request: configuration is invalid: 2 errors occurred:
            	* client certificate required for mutual tls
            	* private key required for mutual tls
            
            : 
    --- FAIL: TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_but_invalid_client_cert (0.04s)
        config.go:68: failed applying YAML to cluster cluster-0: error when creating "/tmp/security-sds-tls-origination-b1/TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_but_invalid_client_cert/tmpyaml_336968736": admission webhook "validation.istio.io" denied the request: configuration is invalid: 2 errors occurred:
            	* client certificate required for mutual tls
            	* private key required for mutual tls
            
            : 
    --- FAIL: TestMutualTlsOrigination/MUTUAL_TLS_with_credentialName_set_when_the_underlying_secret_doesn't_exist (0.03s)
        config.go:68: failed applying YAML to cluster cluster-0: error when creating "/tmp/security-sds-tls-origination-b1/TestMutualTlsOrigination/MUTUAL_TLS_with_credentialName_set_when_the_underlying_secret_doesn't_exist/tmpyaml_235108095": admission webhook "validation.istio.io" denied the request: configuration is invalid: 2 errors occurred:
            	* client certificate required for mutual tls
            	* private key required for mutual tls
            
            : 
    --- FAIL: TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_but_no_client_certs (0.04s)
        config.go:68: failed applying YAML to cluster cluster-0: error when creating "/tmp/security-sds-tls-origination-b1/TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_but_no_client_certs/tmpyaml_615125074": admission webhook "validation.istio.io" denied the request: configuration is invalid: 2 errors occurred:
            	* client certificate required for mutual tls
            	* private key required for mutual tls
            
            : 
FAIL
2020-11-24T19:11:08.118508Z	info	tf	=== FAILED: Test Run: 'security_sds_tls_origination' (exitCode: 1) ===
2020-11-24T19:11:08.118539Z	info	tf	=== Suite "security_sds_tls_origination" run time: 1m32.496815745s ===
FAIL	istio.io/istio/tests/integration/security/sds_tls_origination	92.617s
?   	istio.io/istio/tests/integration/security/sds_tls_origination/util	[no test files]
FAIL
