2020-11-24T05:49:45.306011Z	info	tf	=== Test Framework Settings ===
2020-11-24T05:49:45.306213Z	info	tf	TestID:            security_sds_tls_origination
RunID:             faa62b18-28f8-4c19-8472-a63756d4479a
NoCleanup:         true
BaseDir:           /tmp
Selector:          
FailOnDeprecation: false

2020-11-24T05:49:45.306219Z	info	tf	===============================
2020-11-24T05:49:45.306335Z	info	tf	Test run dir: /tmp/security-sds-tls-origination-fa
2020-11-24T05:49:45.306416Z	info	tf	Test Framework Kubernetes environment Settings:
KubeConfig:           [/root/bmctl-workspace/asm7-build71/asm7-build71-kubeconfig]
MiniKubeIngress:      false
ControlPlaneTopology: map[0:0]
NetworkTopology:      map[]

2020-11-24T05:49:45.309861Z	info	tf	=== BEGIN: Setup: 'security_sds_tls_origination' ===
2020-11-24T05:49:45.320314Z	info	tf	=== BEGIN: Deploy Istio [Suite=security_sds_tls_origination] ===
2020-11-24T05:49:45.320378Z	info	tf	=== Istio Component Config ===
2020-11-24T05:49:45.320418Z	info	tf	
SystemNamespace:                istio-system
IstioNamespace:                 istio-system
ConfigNamespace:                istio-system
TelemetryNamespace:             istio-system
PolicyNamespace:                istio-system
IngressNamespace:               istio-system
EgressNamespace:                istio-system
DeployIstio:                    true
DeployTimeout:                  5m0s
UndeployTimeout:                5m0s
Values:                         map[global.hub:gcr.io/mixologist-142215/baremetal_asm global.imagePullPolicy:Always global.tag:1.7.3]
IOPFile:                        tests/integration/iop-integration-test-defaults.yaml
SkipWaitForValidationWebhook:   false
CustomSidecarInjectorNamespace: 

2020-11-24T05:49:45.320453Z	info	tf	================================
2020-11-24T05:49:45.321363Z	info	proto: tag has too few fields: "-"
2020-11-24T05:49:45.731745Z	info	tf	Running istio control plane on cluster cluster-0 [install --skip-confirmation -f /root/go_projects/src/istio.io/istio/tests/integration/iop-integration-test-defaults.yaml -f /tmp/security-sds-tls-origination-fa/_suite_context/istio-deployment-670865367/iop.yaml --set values.global.imagePullPolicy=Always --manifests /root/go_projects/src/istio.io/istio/manifests --set values.global.tag=1.7.3 --set values.global.imagePullPolicy=Always --set values.global.hub=gcr.io/mixologist-142215/baremetal_asm]

- Processing resources for Istio core.
✔ Istio core installed
- Processing resources for Istiod.
- Processing resources for Istiod. Waiting for Deployment/istio-system/istiod
✔ Istiod installed
- Processing resources for Egress gateways.
- Processing resources for Egress gateways. Waiting for Deployment/istio-syst...
✔ Egress gateways installed
- Pruning removed resources
✔ Installation complete2020-11-24T05:50:04.168912Z	info	tf	Creating dummy rule to check for validation webhook readiness
2020-11-24T05:50:04.493057Z	info	tf	Creating dummy rule to check for validation webhook readiness
2020-11-24T05:50:04.561393Z	info	tf	=== SUCCEEDED: Deploy Istio [Suite=security_sds_tls_origination]===
2020-11-24T05:50:04.561438Z	info	tf	=== DONE: Setup: 'security_sds_tls_origination' (19.251537973s) ===
2020-11-24T05:50:04.561443Z	info	tf	=== BEGIN: Test Run: 'security_sds_tls_origination' ===
2020-11-24T05:50:04.561936Z	info	tf	=== BEGIN: Test: 'security_sds_tls_origination[TestSimpleTlsOrigination]' ===
2020-11-24T05:50:04.801960Z	info	tf	Checking pods ready...
2020-11-24T05:50:04.802020Z	info	tf	Checking pods ready...
2020-11-24T05:50:04.802041Z	info	tf	Checking pods ready...
2020-11-24T05:50:04.802080Z	info	tf	Checking pods ready...
2020-11-24T05:50:04.811137Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-9hwxr         Pending (Pending)
2020-11-24T05:50:04.967979Z	info	tf	  [ 0]                    client-v1-5589bc9b54-l7x89         Pending (Pending)
2020-11-24T05:50:05.811400Z	info	tf	Checking pods ready...
2020-11-24T05:50:05.811443Z	info	tf	Checking pods ready...
2020-11-24T05:50:05.816796Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-9hwxr         Pending (Pending)
2020-11-24T05:50:05.968248Z	info	tf	Checking pods ready...
2020-11-24T05:50:05.968305Z	info	tf	Checking pods ready...
2020-11-24T05:50:05.973670Z	info	tf	  [ 0]                    client-v1-5589bc9b54-l7x89         Pending (Pending)
2020-11-24T05:50:06.817062Z	info	tf	Checking pods ready...
2020-11-24T05:50:06.817119Z	info	tf	Checking pods ready...
2020-11-24T05:50:06.821920Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-9hwxr         Pending (Pending)
2020-11-24T05:50:06.973877Z	info	tf	Checking pods ready...
2020-11-24T05:50:06.973923Z	info	tf	Checking pods ready...
2020-11-24T05:50:06.978530Z	info	tf	  [ 0]                    client-v1-5589bc9b54-l7x89         Pending (Pending)
2020-11-24T05:50:07.822005Z	info	tf	Checking pods ready...
2020-11-24T05:50:07.822061Z	info	tf	Checking pods ready...
2020-11-24T05:50:07.827177Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-9hwxr         Running (container not ready: 'app')
2020-11-24T05:50:07.978777Z	info	tf	Checking pods ready...
2020-11-24T05:50:07.978835Z	info	tf	Checking pods ready...
2020-11-24T05:50:07.984387Z	info	tf	  [ 0]                    client-v1-5589bc9b54-l7x89         Pending (Pending)
2020-11-24T05:50:08.827493Z	info	tf	Checking pods ready...
2020-11-24T05:50:08.827540Z	info	tf	Checking pods ready...
2020-11-24T05:50:08.832538Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-9hwxr         Running (container not ready: 'app')
2020-11-24T05:50:08.984649Z	info	tf	Checking pods ready...
2020-11-24T05:50:08.984710Z	info	tf	Checking pods ready...
2020-11-24T05:50:08.990158Z	info	tf	  [ 0]                    client-v1-5589bc9b54-l7x89         Running (container not ready: 'app')
2020-11-24T05:50:09.832830Z	info	tf	Checking pods ready...
2020-11-24T05:50:09.832889Z	info	tf	Checking pods ready...
2020-11-24T05:50:09.837853Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-9hwxr         Running (container not ready: 'app')
2020-11-24T05:50:09.990404Z	info	tf	Checking pods ready...
2020-11-24T05:50:09.990463Z	info	tf	Checking pods ready...
2020-11-24T05:50:09.995830Z	info	tf	  [ 0]                    client-v1-5589bc9b54-l7x89         Running (container not ready: 'app')
2020-11-24T05:50:10.838187Z	info	tf	Checking pods ready...
2020-11-24T05:50:10.838242Z	info	tf	Checking pods ready...
2020-11-24T05:50:10.848569Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-9hwxr         Running (container not ready: 'app')
2020-11-24T05:50:10.996075Z	info	tf	Checking pods ready...
2020-11-24T05:50:10.996131Z	info	tf	Checking pods ready...
2020-11-24T05:50:11.002124Z	info	tf	  [ 0]                    client-v1-5589bc9b54-l7x89         Running (container not ready: 'app')
2020-11-24T05:50:11.848840Z	info	tf	Checking pods ready...
2020-11-24T05:50:11.848896Z	info	tf	Checking pods ready...
2020-11-24T05:50:11.853678Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-9hwxr         Running (Ready)
2020-11-24T05:50:12.002379Z	info	tf	Checking pods ready...
2020-11-24T05:50:12.002438Z	info	tf	Checking pods ready...
2020-11-24T05:50:12.007868Z	info	tf	  [ 0]                    client-v1-5589bc9b54-l7x89         Running (container not ready: 'istio-proxy')
2020-11-24T05:50:13.008063Z	info	tf	Checking pods ready...
2020-11-24T05:50:13.008127Z	info	tf	Checking pods ready...
2020-11-24T05:50:13.013561Z	info	tf	  [ 0]                    client-v1-5589bc9b54-l7x89         Running (Ready)
2020-11-24T05:50:22.342625Z	info	tf	=== DONE (passed):  Test: 'security_sds_tls_origination[TestSimpleTlsOrigination] (17.780679104s)' ===
2020-11-24T05:50:22.343224Z	info	tf	=== BEGIN: Test: 'security_sds_tls_origination[TestMutualTlsOrigination]' ===
2020-11-24T05:50:24.923616Z	info	tf	Checking pods ready...
2020-11-24T05:50:24.923660Z	info	tf	Checking pods ready...
2020-11-24T05:50:24.923658Z	info	tf	Checking pods ready...
2020-11-24T05:50:24.923683Z	info	tf	Checking pods ready...
2020-11-24T05:50:25.124437Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-qjxg2         Pending (Pending)
2020-11-24T05:50:25.324467Z	info	tf	  [ 0]                    client-v1-5589bc9b54-rvvsn         Pending (Pending)
2020-11-24T05:50:26.124748Z	info	tf	Checking pods ready...
2020-11-24T05:50:26.124793Z	info	tf	Checking pods ready...
2020-11-24T05:50:26.136798Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-qjxg2         Pending (Pending)
2020-11-24T05:50:26.324717Z	info	tf	Checking pods ready...
2020-11-24T05:50:26.324795Z	info	tf	Checking pods ready...
2020-11-24T05:50:26.330446Z	info	tf	  [ 0]                    client-v1-5589bc9b54-rvvsn         Pending (Pending)
2020-11-24T05:50:27.136930Z	info	tf	Checking pods ready...
2020-11-24T05:50:27.136979Z	info	tf	Checking pods ready...
2020-11-24T05:50:27.141740Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-qjxg2         Running (container not ready: 'app')
2020-11-24T05:50:27.330656Z	info	tf	Checking pods ready...
2020-11-24T05:50:27.330701Z	info	tf	Checking pods ready...
2020-11-24T05:50:27.336040Z	info	tf	  [ 0]                    client-v1-5589bc9b54-rvvsn         Pending (Pending)
2020-11-24T05:50:28.142009Z	info	tf	Checking pods ready...
2020-11-24T05:50:28.142067Z	info	tf	Checking pods ready...
2020-11-24T05:50:28.146890Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-qjxg2         Running (container not ready: 'app')
2020-11-24T05:50:28.336108Z	info	tf	Checking pods ready...
2020-11-24T05:50:28.336158Z	info	tf	Checking pods ready...
2020-11-24T05:50:28.341158Z	info	tf	  [ 0]                    client-v1-5589bc9b54-rvvsn         Pending (Pending)
2020-11-24T05:50:29.147124Z	info	tf	Checking pods ready...
2020-11-24T05:50:29.147168Z	info	tf	Checking pods ready...
2020-11-24T05:50:29.152225Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-qjxg2         Running (container not ready: 'app')
2020-11-24T05:50:29.341395Z	info	tf	Checking pods ready...
2020-11-24T05:50:29.341455Z	info	tf	Checking pods ready...
2020-11-24T05:50:29.346896Z	info	tf	  [ 0]                    client-v1-5589bc9b54-rvvsn         Running (container not ready: 'app')
2020-11-24T05:50:30.152479Z	info	tf	Checking pods ready...
2020-11-24T05:50:30.152539Z	info	tf	Checking pods ready...
2020-11-24T05:50:30.157849Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-qjxg2         Running (container not ready: 'app')
2020-11-24T05:50:30.347140Z	info	tf	Checking pods ready...
2020-11-24T05:50:30.347204Z	info	tf	Checking pods ready...
2020-11-24T05:50:30.352502Z	info	tf	  [ 0]                    client-v1-5589bc9b54-rvvsn         Running (container not ready: 'app')
2020-11-24T05:50:31.158148Z	info	tf	Checking pods ready...
2020-11-24T05:50:31.158210Z	info	tf	Checking pods ready...
2020-11-24T05:50:31.163520Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-qjxg2         Running (container not ready: 'app')
2020-11-24T05:50:31.352775Z	info	tf	Checking pods ready...
2020-11-24T05:50:31.352839Z	info	tf	Checking pods ready...
2020-11-24T05:50:31.358069Z	info	tf	  [ 0]                    client-v1-5589bc9b54-rvvsn         Running (container not ready: 'app')
2020-11-24T05:50:32.163678Z	info	tf	Checking pods ready...
2020-11-24T05:50:32.163775Z	info	tf	Checking pods ready...
2020-11-24T05:50:32.169299Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-qjxg2         Running (container not ready: 'app')
2020-11-24T05:50:32.358292Z	info	tf	Checking pods ready...
2020-11-24T05:50:32.358344Z	info	tf	Checking pods ready...
2020-11-24T05:50:32.364420Z	info	tf	  [ 0]                    client-v1-5589bc9b54-rvvsn         Running (container not ready: 'app')
2020-11-24T05:50:33.169555Z	info	tf	Checking pods ready...
2020-11-24T05:50:33.169627Z	info	tf	Checking pods ready...
2020-11-24T05:50:33.174786Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-qjxg2         Running (container not ready: 'app')
2020-11-24T05:50:33.364651Z	info	tf	Checking pods ready...
2020-11-24T05:50:33.364713Z	info	tf	Checking pods ready...
2020-11-24T05:50:33.370504Z	info	tf	  [ 0]                    client-v1-5589bc9b54-rvvsn         Running (Ready)
2020-11-24T05:50:34.175016Z	info	tf	Checking pods ready...
2020-11-24T05:50:34.175074Z	info	tf	Checking pods ready...
2020-11-24T05:50:34.180534Z	info	tf	  [ 0]                    server-v1-7498d9c8d9-qjxg2         Running (Ready)
2020-11-24T05:50:40.768229Z	info	tf	=== BEGIN: Test: 'security_sds_tls_origination[TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_but_invalid_client_cert]' ===
2020-11-24T05:50:40.804705Z	info	tf	=== DONE (failed):  Test: 'security_sds_tls_origination[TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_but_invalid_client_cert] (36.47277ms)' ===
2020-11-24T05:50:40.804901Z	info	tf	=== BEGIN: Test: 'security_sds_tls_origination[TestMutualTlsOrigination/MUTUAL_TLS_with_credentialName_set_when_the_underlying_secret_doesn't_exist]' ===
2020-11-24T05:50:40.838316Z	info	tf	=== DONE (failed):  Test: 'security_sds_tls_origination[TestMutualTlsOrigination/MUTUAL_TLS_with_credentialName_set_when_the_underlying_secret_doesn't_exist] (33.406523ms)' ===
2020-11-24T05:50:40.838496Z	info	tf	=== BEGIN: Test: 'security_sds_tls_origination[TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_but_no_client_certs]' ===
2020-11-24T05:50:40.874658Z	info	tf	=== DONE (failed):  Test: 'security_sds_tls_origination[TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_but_no_client_certs] (36.158276ms)' ===
2020-11-24T05:50:40.874847Z	info	tf	=== BEGIN: Test: 'security_sds_tls_origination[TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_and_client_certs_and_generic_secret_type]' ===
2020-11-24T05:50:40.917965Z	info	tf	=== DONE (failed):  Test: 'security_sds_tls_origination[TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_and_client_certs_and_generic_secret_type] (43.113687ms)' ===
2020-11-24T05:50:40.918165Z	info	tf	=== BEGIN: Test: 'security_sds_tls_origination[TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_and_client_certs_and_non_generic_secret_type]' ===
2020-11-24T05:50:40.948360Z	info	tf	=== DONE (failed):  Test: 'security_sds_tls_origination[TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_and_client_certs_and_non_generic_secret_type] (30.189898ms)' ===
2020-11-24T05:50:41.817007Z	info	tf	=== DONE (failed):  Test: 'security_sds_tls_origination[TestMutualTlsOrigination] (19.473760026s)' ===
2020-11-24T05:50:41.817115Z	error	tf	=== Dumping Namespace client-3-18619 State...
2020-11-24T05:50:43.364097Z	error	tf	=== Dumping Namespace server-4-93830 State...
--- FAIL: TestMutualTlsOrigination (21.05s)
    --- FAIL: TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_but_invalid_client_cert (0.04s)
        config.go:68: failed applying YAML to cluster cluster-0: error when creating "/tmp/security-sds-tls-origination-fa/TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_but_invalid_client_cert/tmpyaml_364569936": admission webhook "validation.istio.io" denied the request: configuration is invalid: 2 errors occurred:
            	* client certificate required for mutual tls
            	* private key required for mutual tls
            
            : 
    --- FAIL: TestMutualTlsOrigination/MUTUAL_TLS_with_credentialName_set_when_the_underlying_secret_doesn't_exist (0.03s)
        config.go:68: failed applying YAML to cluster cluster-0: error when creating "/tmp/security-sds-tls-origination-fa/TestMutualTlsOrigination/MUTUAL_TLS_with_credentialName_set_when_the_underlying_secret_doesn't_exist/tmpyaml_691873391": admission webhook "validation.istio.io" denied the request: configuration is invalid: 2 errors occurred:
            	* client certificate required for mutual tls
            	* private key required for mutual tls
            
            : 
    --- FAIL: TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_but_no_client_certs (0.04s)
        config.go:68: failed applying YAML to cluster cluster-0: error when creating "/tmp/security-sds-tls-origination-fa/TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_but_no_client_certs/tmpyaml_298244866": admission webhook "validation.istio.io" denied the request: configuration is invalid: 2 errors occurred:
            	* client certificate required for mutual tls
            	* private key required for mutual tls
            
            : 
    --- FAIL: TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_and_client_certs_and_generic_secret_type (0.04s)
        config.go:68: failed applying YAML to cluster cluster-0: error when creating "/tmp/security-sds-tls-origination-fa/TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_and_client_certs_and_generic_secret_type/tmpyaml_794108025": admission webhook "validation.istio.io" denied the request: configuration is invalid: 2 errors occurred:
            	* client certificate required for mutual tls
            	* private key required for mutual tls
            
            : 
    --- FAIL: TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_and_client_certs_and_non_generic_secret_type (0.03s)
        config.go:68: failed applying YAML to cluster cluster-0: error when creating "/tmp/security-sds-tls-origination-fa/TestMutualTlsOrigination/MUTUAL_TLS_with_correct_root_cert_and_client_certs_and_non_generic_secret_type/tmpyaml_129134980": admission webhook "validation.istio.io" denied the request: configuration is invalid: 2 errors occurred:
            	* client certificate required for mutual tls
            	* private key required for mutual tls
            
            : 
FAIL
2020-11-24T05:50:43.394754Z	info	tf	=== FAILED: Test Run: 'security_sds_tls_origination' (exitCode: 1) ===
2020-11-24T05:50:43.394805Z	info	tf	=== Suite "security_sds_tls_origination" run time: 58.084942569s ===
FAIL	istio.io/istio/tests/integration/security/sds_tls_origination	58.240s
?   	istio.io/istio/tests/integration/security/sds_tls_origination/util	[no test files]
FAIL
